---
import BaseCaseStudy from './BaseCaseStudy.astro';

const {
  title = '',
  quantifiedOutcome = '',
  keyResults = [],
  situation = '',
  intervention = [],
  playbook = [],
  role,
  timeframe,
  domain,
  githubUrl,
} = Astro.props as {
  title: string;
  quantifiedOutcome: string;
  keyResults: string[];
  situation: string;
  intervention: string[];
  playbook: string[];
  role?: string;
  timeframe?: string;
  domain?: string;
  githubUrl?: string;
};
---

<article class="rounded-lg border border-neutral-200 bg-white/80 shadow-sm">
	<div class="px-4 py-4 md:px-6 md:py-6">
		<!-- ALWAYS VISIBLE: Title, Quantified Outcome, Playbook -->
		<header class="space-y-3">
			<h3 class="text-lg md:text-xl font-semibold tracking-tight">{title}</h3>
			<p class="text-lg md:text-xl font-medium text-neutral-900">{quantifiedOutcome}</p>
			{(role || timeframe || domain) && (
				<div class="mt-2 flex flex-wrap gap-2 text-sm text-neutral-700">
					{role && (<span class="inline-flex items-center rounded-md border border-neutral-200 bg-neutral-50 px-2 py-0.5">{role}</span>)}
					{timeframe && (<span class="inline-flex items-center rounded-md border border-neutral-200 bg-neutral-50 px-2 py-0.5">{timeframe}</span>)}
					{domain && (<span class="inline-flex items-center rounded-md border border-neutral-200 bg-neutral-50 px-2 py-0.5">{domain}</span>)}
				</div>
			)}
		</header>

		{playbook?.length > 0 && (
			<section class="mt-6">
				<h4 class="text-base md:text-lg font-semibold">My Repeatable Playbook</h4>
				<ol class="mt-2 list-decimal pl-5 space-y-2 text-neutral-900 leading-relaxed rounded-md border border-neutral-200 bg-neutral-50 p-3 md:p-4">
					{playbook.map((step) => <li>{step}</li>)}
				</ol>
			</section>
		)}

		<!-- GitHub link section (if provided) -->
		{githubUrl && (
			<div class="mt-4 pt-4 border-t border-neutral-200">
				<a href={githubUrl} target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-base font-medium text-neutral-800 hover:text-neutral-950">
					View on GitHub
					<svg class="ml-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
				</a>
			</div>
		)}

		<!-- COLLAPSIBLE: Situation + Intervention + Key Results -->
		<details class="mt-6 group cs-disclosure">
			<summary class="w-full cursor-pointer inline-flex items-center rounded-md border border-neutral-300 bg-white px-3 py-1.5 text-sm md:text-base text-slate-900 hover:bg-neutral-50 focus:outline-none focus-visible:ring-2 focus-visible:ring-neutral-300 select-none">
				<span class="group-open:inline hidden">Hide full story</span>
				<span class="group-open:hidden inline">Read full story</span>
			</summary>

			<div class="mt-6 space-y-6 text-neutral-800">
				<div>
					<h4 class="text-base md:text-lg font-medium">The Situation</h4>
					<p class="mt-2">{situation}</p>
				</div>
				<div>
					<h4 class="text-base md:text-lg font-medium">My Intervention</h4>
					{intervention?.length > 0 && (
						<ol class="mt-2 list-decimal pl-5 space-y-2 leading-relaxed">
							{intervention.map((step) => <li>{step}</li>)}
						</ol>
					)}
				</div>
				{keyResults?.length > 0 && (
					<div>
						<h4 class="text-base md:text-lg font-medium">Key Results</h4>
						<ul class="mt-2 list-disc pl-5 space-y-2 text-neutral-800 leading-relaxed">
							{keyResults.map((item) => <li>{item}</li>)}
						</ul>
					</div>
				)}
			</div>
		</details>
	</div>
</article>

<style>
	/* Hide default marker only within this component */
	.cs-disclosure summary::-webkit-details-marker {
		display: none;
	}
</style>


